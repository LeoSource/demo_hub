import torch
from torch import nn
from torch.nn import functional as F


class SimpleModel(nn.Module):
    def __init__(self,input_feature,hidden_feature,output_feature,training=True):
        super().__init__()
        self.linear1 = nn.Linear(input_feature,hidden_feature,dtype=torch.float64)
        self.linear2 = nn.Linear(hidden_feature,output_feature,dtype=torch.float64)
        if not training:
            self.init_trained_model()
    
    def forward(self,x):
        y = self.linear1(x)
        y = F.tanh(y)
        y = self.linear2(y)
        return y
    
    def init_trained_model(self):
        w = torch.tensor([
            [1.5463239465936677863,2.0171237551863843152,2.5186249471680177692,-0.36298200309735306757],
            [-1.8567699056868907093,0.45551957252592223391,0.61130391619940782633,0.89051830704166212715],
            [1.6759006496089532412,-0.036784581893339204917,1.6072563152589085522,0.91922206982539289566],
            [-2.1965321350548308033,1.3336464947976875983,2.4833228418320798525,-1.7147846695779915827],
            [-0.20356020037894645425,-0.89757582062514817967,-0.36676666841120741935,-1.0261777920962404931],
            [1.9017314997938388199,-2.5985476136238649936,0.7659649431482307147,-0.50819398456915787499],
            [-0.15259966299254157374,-0.7566840450698590903,0.17419231848620839176,0.77551960356847560174],
            [-0.11694497426787399397,-0.6224709535342514144,-0.28297270285862441419,-0.71466147603123242327],
            [4.92294644354208355,-1.6021223305609424425,-4.8897931050054648239,1.0025868906142709758],
            [0.2309299310651064252,2.9955715750603388869,-0.22299315851744749839,-3.1110245552683473136],
            [-1.8571309796877675247,-3.1470409448893263971,1.8411278403408244397,3.3456887650568614134],
            [-1.8232829178856444496,-0.60790972971625301113,2.0093633660603655855,0.37058428968261669656],
            [5.9124326465908110251,0.64899373978493268833,-6.0718686786165081415,-0.74167239866756584643],
            [-0.012792641454432041037,-0.057301847374916899114,0.21215018229908458314,-0.10755933008963446118],
            [2.2728239516087742622,-1.3973201080530250895,-2.552391027223767761,1.7659377222133931795],
            [-0.038678291231267994399,-0.18694529756085384586,-0.079664046309998348683,-0.21827137712938632363],
            [0.81521147459316312123,-1.9262288406983805178,1.8982625786747919783,1.3450806119899809676],
            [1.9618679474640290383,-4.670093654278027806,-1.988215270789555511,4.8626287287359541978],
            [-2.1996358586330124751,0.45598114217231355827,2.2773362333276119251,-0.5138707865224435567],
            [0.12065129614417610671,0.77820828921917817311,0.18586514265232148557,-2.3645718818398324679],
            [-0.43457898306549935796,2.0148869849055328629,-0.88635939260307350374,1.337914620279698541],
            [4.5997511038303491304,-0.98935273737290396756,-4.4461953813524486279,0.80749553094127468622],
            [0.16672650466610125508,0.78012563709879290119,-0.1709632323506097562,-0.80108830567763100738],
            [-0.40905808652797454039,1.3057754310030089684,3.248432291982300324,-0.040362892496793138786],
            [-1.9643881032955714527,-3.229248636962832375,1.9904460972035380451,3.1927615629613295134],
            [-3.6472822291698432373,-2.3633439639818267786,3.6690743686984501615,2.4985967183001687175],
            [-3.226807034135848351,-2.1052253038820394337,3.2268990886007480334,2.2044570550686826138],
            [-0.16001829183129748224,-3.1846057791510227197,0.17987064193799576217,3.2630544997169175225],
            [0.023815833349145061615,0.12923302806990075164,-0.42535351964301504335,0.23117068840207552483],
            [-0.74218584677495114121,0.79046815568789141615,-1.0350268530135831035,2.0112453152135789658],
            [-1.3403122822967514782,1.779062431065176586,0.97419562457228858765,1.0209623865828594269],
            [0.63071324029550746015,-1.4039058765710488164,-2.3256947976549109391,-0.60763155676562996543]])
        self.linear1.weight.data = w
        b = torch.tensor([-2.27634743868437317,2.7728767677620167476,-3.8010848452315393331,-0.048541788895079200639,
                          2.6342891248003907911,-1.9279761799903718522,1.0840322541576892235,-1.4372116590682402215,
                          -1.418287793588869139,1.3311375478360936153,1.4845625374193682777,0.13803649381636040605,
                          0.10955468088863608289,0.46855892918268082781,0.042187975128613004749,0.12244590122727273818,
                          0.17483715322656190327,0.057617669868894445806,-0.12379443024785258265,1.133510721599795712,
                          -1.8721498079844529627,1.444584340139313472,1.133203687712064367,-0.14759138333189941727,
                          -1.5009842086014146822,-0.79220116997705392059,-0.44859112263473627236,1.2816166633938954611,
                          0.8278812123558441094,-3.8130610316545450189,-3.6384809677038427722,-2.8930549010802546483])
        self.linear1.bias.data = b
        w2 = torch.tensor([
            [0.00096379048346617352157,0.005926071742787034774,0.0070918833506383978718,0.33763505866106935382,
            -0.079181447708180585643,0.0017155606706343886052,0.095067006832671427374,-0.12603427189171181877,
            -0.0065344196832138783451,-0.0025613654471442169613,0.0077824109213060045989,0.019415758055832472301,
            0.013934221356025223298,3.8530303598318988989,0.33430888288482607518,-1.6437589944893680194,
            0.00099896305533052624955,0.0046390377254984672267,-0.031304391138291108587,0.0053273641855894520239,
            -0.0023173548307398577489,-0.0093256426856202414427,-0.09998453786756517081,0.00041723551922302390925,
            0.0051327141587298634809,0.02696976433050271571,-0.042587708928507418682,-0.00084977078484172222875,
            -0.88870864837617857823,0.018087337181839080458,-0.0034643862674092773014,0.0060163008186903642327],
            [-0.0010306601749229145609,0.005873917716429027415,0.010736179663504603898,-0.16729523382580113733,
             -0.08633097335994337207,0.00081621662698830223931,0.5730649083856106385,-0.13716658566940506669,
             0.0029715808521275670004,-0.031629867122476305885,0.014532878935894704558,0.0057356564088247652747,
             -0.00069090697222957476228,-1.1228518549142403327,-0.16514024528704132622,-1.9263104913730395573,
             0.002266502741701548803,-0.012713261994430019239,0.0048596055832244256997,0.0021983746914554470539,
             0.0018218714514634660843,0.0011577144050303874931,-0.5482076977777353699,-0.00064275453357852505194,
             0.01221636559466234874,0.012454886072910179712,-0.02078506477399057889,0.028382486149490859101,
             0.28520988817096776247,0.014879152276818345679,-0.0051607159219393640079,0.0023297969816105674329]
        ])
        self.linear2.weight.data = w2
        b2 = torch.tensor([-0.88845993501662456904,0.50616684823571556073])
        self.linear2.bias.data = b2




class MyNetModule(nn.Module):
    def __init__(self,training=True):
        super().__init__()
        if training:
            self.init_training_model()
        else:
            self.init_trained_model()

    def forward(self,x):
        y = self.process_input(x)
        y = self.linear1(y)
        y = F.tanh(y)
        y = self.linear2(y)
        y = self.process_output(y)
        return y
    
    def process_input(self,x):
        y = x-self.in_xoffset
        y *= self.in_gain
        y += self.in_ymin
        return y
    
    def process_output(self,y):
        x = y-self.out_ymin
        x /= self.out_gain
        x += self.out_xoffset
        return x

    def init_training_model(self):
        self.in_xoffset = nn.Parameter(torch.randn(4,))
        self.in_gain = nn.Parameter(torch.randn(4,))
        self.in_ymin = -1.0
        self.out_xoffset = nn.Parameter(torch.randn(2,))
        self.out_gain = nn.Parameter(torch.randn(2,))
        self.out_ymin = -1.0
        self.linear1 = nn.Linear(4,32)
        self.linear2 = nn.Linear(32,2)

    def init_trained_model(self):
        self.in_xoffset = nn.Parameter(torch.tensor([-0.52618405,-0.5318202,-0.52618405,-0.5318202]))
        self.in_gain = nn.Parameter(torch.tensor([1.88956130187524,1.88104208941716,1.88956130187524,1.88104208941716]))
        self.in_ymin = -1.0
        self.out_xoffset = nn.Parameter(torch.tensor([-0.51504488,-0.51970131]))
        self.out_gain = nn.Parameter(torch.tensor([1.93526975521915,1.92980377369268]))
        self.out_ymin = -1.0
        self.linear1 = nn.Linear(4,32)
        self.linear2 = nn.Linear(32,2)
        w = torch.tensor([
            [1.5463239465936677863,2.0171237551863843152,2.5186249471680177692,-0.36298200309735306757],
            [-1.8567699056868907093,0.45551957252592223391,0.61130391619940782633,0.89051830704166212715],
            [1.6759006496089532412,-0.036784581893339204917,1.6072563152589085522,0.91922206982539289566],
            [-2.1965321350548308033,1.3336464947976875983,2.4833228418320798525,-1.7147846695779915827],
            [-0.20356020037894645425,-0.89757582062514817967,-0.36676666841120741935,-1.0261777920962404931],
            [1.9017314997938388199,-2.5985476136238649936,0.7659649431482307147,-0.50819398456915787499],
            [-0.15259966299254157374,-0.7566840450698590903,0.17419231848620839176,0.77551960356847560174],
            [-0.11694497426787399397,-0.6224709535342514144,-0.28297270285862441419,-0.71466147603123242327],
            [4.92294644354208355,-1.6021223305609424425,-4.8897931050054648239,1.0025868906142709758],
            [0.2309299310651064252,2.9955715750603388869,-0.22299315851744749839,-3.1110245552683473136],
            [-1.8571309796877675247,-3.1470409448893263971,1.8411278403408244397,3.3456887650568614134],
            [-1.8232829178856444496,-0.60790972971625301113,2.0093633660603655855,0.37058428968261669656],
            [5.9124326465908110251,0.64899373978493268833,-6.0718686786165081415,-0.74167239866756584643],
            [-0.012792641454432041037,-0.057301847374916899114,0.21215018229908458314,-0.10755933008963446118],
            [2.2728239516087742622,-1.3973201080530250895,-2.552391027223767761,1.7659377222133931795],
            [-0.038678291231267994399,-0.18694529756085384586,-0.079664046309998348683,-0.21827137712938632363],
            [0.81521147459316312123,-1.9262288406983805178,1.8982625786747919783,1.3450806119899809676],
            [1.9618679474640290383,-4.670093654278027806,-1.988215270789555511,4.8626287287359541978],
            [-2.1996358586330124751,0.45598114217231355827,2.2773362333276119251,-0.5138707865224435567],
            [0.12065129614417610671,0.77820828921917817311,0.18586514265232148557,-2.3645718818398324679],
            [-0.43457898306549935796,2.0148869849055328629,-0.88635939260307350374,1.337914620279698541],
            [4.5997511038303491304,-0.98935273737290396756,-4.4461953813524486279,0.80749553094127468622],
            [0.16672650466610125508,0.78012563709879290119,-0.1709632323506097562,-0.80108830567763100738],
            [-0.40905808652797454039,1.3057754310030089684,3.248432291982300324,-0.040362892496793138786],
            [-1.9643881032955714527,-3.229248636962832375,1.9904460972035380451,3.1927615629613295134],
            [-3.6472822291698432373,-2.3633439639818267786,3.6690743686984501615,2.4985967183001687175],
            [-3.226807034135848351,-2.1052253038820394337,3.2268990886007480334,2.2044570550686826138],
            [-0.16001829183129748224,-3.1846057791510227197,0.17987064193799576217,3.2630544997169175225],
            [0.023815833349145061615,0.12923302806990075164,-0.42535351964301504335,0.23117068840207552483],
            [-0.74218584677495114121,0.79046815568789141615,-1.0350268530135831035,2.0112453152135789658],
            [-1.3403122822967514782,1.779062431065176586,0.97419562457228858765,1.0209623865828594269],
            [0.63071324029550746015,-1.4039058765710488164,-2.3256947976549109391,-0.60763155676562996543]])
        self.linear1.weight.data = w
        b = torch.tensor([-2.27634743868437317,2.7728767677620167476,-3.8010848452315393331,-0.048541788895079200639,
                          2.6342891248003907911,-1.9279761799903718522,1.0840322541576892235,-1.4372116590682402215,
                          -1.418287793588869139,1.3311375478360936153,1.4845625374193682777,0.13803649381636040605,
                          0.10955468088863608289,0.46855892918268082781,0.042187975128613004749,0.12244590122727273818,
                          0.17483715322656190327,0.057617669868894445806,-0.12379443024785258265,1.133510721599795712,
                          -1.8721498079844529627,1.444584340139313472,1.133203687712064367,-0.14759138333189941727,
                          -1.5009842086014146822,-0.79220116997705392059,-0.44859112263473627236,1.2816166633938954611,
                          0.8278812123558441094,-3.8130610316545450189,-3.6384809677038427722,-2.8930549010802546483])
        self.linear1.bias.data = b
        w2 = torch.tensor([
            [0.00096379048346617352157,0.005926071742787034774,0.0070918833506383978718,0.33763505866106935382,
            -0.079181447708180585643,0.0017155606706343886052,0.095067006832671427374,-0.12603427189171181877,
            -0.0065344196832138783451,-0.0025613654471442169613,0.0077824109213060045989,0.019415758055832472301,
            0.013934221356025223298,3.8530303598318988989,0.33430888288482607518,-1.6437589944893680194,
            0.00099896305533052624955,0.0046390377254984672267,-0.031304391138291108587,0.0053273641855894520239,
            -0.0023173548307398577489,-0.0093256426856202414427,-0.09998453786756517081,0.00041723551922302390925,
            0.0051327141587298634809,0.02696976433050271571,-0.042587708928507418682,-0.00084977078484172222875,
            -0.88870864837617857823,0.018087337181839080458,-0.0034643862674092773014,0.0060163008186903642327],
            [-0.0010306601749229145609,0.005873917716429027415,0.010736179663504603898,-0.16729523382580113733,
             -0.08633097335994337207,0.00081621662698830223931,0.5730649083856106385,-0.13716658566940506669,
             0.0029715808521275670004,-0.031629867122476305885,0.014532878935894704558,0.0057356564088247652747,
             -0.00069090697222957476228,-1.1228518549142403327,-0.16514024528704132622,-1.9263104913730395573,
             0.002266502741701548803,-0.012713261994430019239,0.0048596055832244256997,0.0021983746914554470539,
             0.0018218714514634660843,0.0011577144050303874931,-0.5482076977777353699,-0.00064275453357852505194,
             0.01221636559466234874,0.012454886072910179712,-0.02078506477399057889,0.028382486149490859101,
             0.28520988817096776247,0.014879152276818345679,-0.0051607159219393640079,0.0023297969816105674329]
        ])
        self.linear2.weight.data = w2
        b2 = torch.tensor([-0.88845993501662456904,0.50616684823571556073])
        self.linear2.bias.data = b2